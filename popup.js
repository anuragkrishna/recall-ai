function render(items){const list=document.getElementById("list");list.innerHTML="";if(items.length===0){list.textContent="No clips";return}items.slice().reverse().forEach(item=>{const div=document.createElement("div");div.className="item";const text=document.createElement("div");text.className="text";text.textContent=item.text;const meta=document.createElement("div");meta.className="meta";const parts=[];if(item.source)parts.push(item.source);if(item.context)parts.push(item.context);parts.push(new Date(item.timestamp).toLocaleString());parts.push(item.status);meta.textContent=parts.join(" â€¢ ");const actions=document.createElement("div");actions.className="actions";const done=document.createElement("button");done.textContent="Mark done";done.onclick=()=>updateStatus(item.id,"done");const remove=document.createElement("button");remove.textContent="Delete";remove.onclick=()=>removeItem(item.id);actions.appendChild(done);actions.appendChild(remove);div.appendChild(text);div.appendChild(meta);div.appendChild(actions);list.appendChild(div)})}
function load(){chrome.storage.local.get({clips:[]},d=>render(d.clips))}
function updateStatus(id,status){chrome.storage.local.get({clips:[]},d=>{const clips=d.clips.map(c=>c.id===id?Object.assign({},c,{status}):c);chrome.storage.local.set({clips},load)})}
function removeItem(id){chrome.storage.local.get({clips:[]},d=>{const clips=d.clips.filter(c=>c.id!==id);chrome.storage.local.set({clips},load)})}
function exportNow(){chrome.storage.local.get({clips:[]},d=>{chrome.storage.sync.get({folder:"RecallAI",filename:"clips.json",saveAs:false},cfg=>{const json=JSON.stringify(d.clips,null,2);const blobUrl=URL.createObjectURL(new Blob([json],{type:"application/json"}));const filename=`${cfg.folder}/${cfg.filename}`;chrome.downloads.download({url:blobUrl,filename,saveAs:cfg.saveAs},()=>{setTimeout(()=>URL.revokeObjectURL(blobUrl),5000)})})})}
document.addEventListener("DOMContentLoaded",()=>{load();document.getElementById("export").onclick=exportNow;document.getElementById("settings").onclick=()=>chrome.runtime.openOptionsPage()})
